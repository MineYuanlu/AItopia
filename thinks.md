# 游戏引擎

AI体有: 玩家, 事件系统, 判定系统
- 玩家: 玩家AI, 控制角色交互
- 判定系统: 输入一条一条日志, 判定相应动作, 例如触发玩家更新、触发事件系统
- 事件系统: 事件触发器, 当判定系统或上帝指示触发事件时, 生成一个合理的事件, 并将其推送到事件队列中, 等待处理

由于LM的限制, 每次输入必定输出, 所以为了减少更新频率, 全局只有判定系统会对每一件事(即一条日志)做出快速判断, 由判断结果触发玩家/事件更新

## 玩家
能力: 对话, 思考, 交互, 移动
- 对话: 会发送到目标玩家, 并记录日志
- 思考: 记录到日志中, 并给出一个思考结果(更新记忆/做出下一步动作等)
- 交互: 与场景互动/与其他玩家互动, 并记录日志
- 移动: 记录日志, 说明要去的地方
func: 更新自己的记忆, 更新关系, 触发事件等函数
可以触发的事件示例: 给手机定闹钟/给XXX打电话
任何触发事件都要通过判定系统判定其合理性, 合理则继续, 否则会被通知失败

## 判定系统
输入: 日志
输出: 动作
- 对于玩家对话: 一段对话开始时, 判定是否能与其对话(例如不在面对面则不能对话, 但可以打电话), 如果可以则进入对话状态, 对话期间不再判定, 直到对话结束, 修改状态. 否则通知玩家失败, 并告诉其原因
- 对于玩家思考: 思考过程不做处理, 思考结束后, 判定是否有下一步动作, 如果有则触发相应事件, 并判定合理性
- 对于玩家交互: 判断是否合理, 如果合理则触发事件, 否则通知玩家失败, 并告诉其原因
- 对于玩家移动: 判断是否合理, 如果合理则触发移动事件, 否则通知玩家失败, 并告诉其原因

由于并不是每一个时间都有事情发生, 则需要一个判定系统来决策下一步骤的时间:
1. 如果是判定失败, 则应不更新时间, 因为这是立即的
2. 如果是对话, 则应按照对话内容长短来更新时间, 因为对话时间长短不一
3. 其它也是如此, 根据具体情况来决定更新时间的大小
4. 此套系统是否不由AI来做, 而是使用规则逻辑来做?

func: 通知玩家, 通知事件, 更新时间

## 事件系统
输入: 判定系统/上帝指示
输出: 立即事件 / 延迟事件 / 周期事件
- 立即事件: 立即触发, 比如手机短信/突发事件
- 延迟事件: 推迟到合适的时间触发, 比如定时器/移动
- 周期事件: 循环触发, 比如每天早上8点触发一次
func: 对玩家/场景进行更新

## 执行系统 (TODO是否和判定系统融合)
输入: 模糊的指令, 例如玩家的指令/事件系统的指令
输出: 具体的指令
此系统传入tools，与真实的游戏进行交互

## 上帝
上帝即为人类用户, 其输入为外部环境, 直接通过事件系统作用于游戏世界, 例如天气变化/新闻发布/财政危机等
func: 触发事件


# UI设计
有俩按钮: 下一个动作/执行动作
- 下一个动作: 游戏停留在方法执行后, 触发AI前, 点击后触发AI
- 执行动作: 游戏停留在触发AI后, 执行操作前, 点击后执行操作
两个按钮都可以设置为自动, 如果两个同时设为自动, 则游戏就会自动运行


# 明确概念
- 玩家: 一个由LLM驱动的AI
- 事件系统: 一个由LLM驱动的系统, 用于触发事件
- 判定系统: 一个由LLM驱动的系统, 用于判断玩家的行为是否合理, 玩家和事件系统之间的中间层
- 上帝: 一个由玩家驱动的系统, 用于影响游戏世界
- 游戏世界: 整个游戏运行的环境, 由场景组成, 包含各个子场景(场景->家->房间 / 场景->公司->办公室 / 场景->玩家)
- 场景: 代表一个地方
- 系统日志: 脱离游戏世界的事件记录, 例如玩家对话过程/思考过程/LLM输出等, 用于记录游戏世界的变化, 给用户提供参考
- 游戏日志: 游戏内的事件记录, 例如玩家对话开始结束/思考结果/交互/移动等, 触发判定系统
